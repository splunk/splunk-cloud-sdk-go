- type: parallel
  steps:
 
  - type: parallel
    name: code quality checks
    steps:
      - name: lint
        service: ssc-client-go
        command: bash -c "make lint"
      - name: vet
        service: ssc-client-go
        command: bash -c "make vet"
      - name: build
        service: ssc-client-go
        command: bash -c "make build"

  - name: unit tests
    service: ssc-client-go
    command: bash -c "make run_unit_tests"

  - name: functional tests
    service: ssc-client-go-with-stubby
    command: bash -c "make run_docker_stubby_tests"

  - type: serial
    name: integration steps
    steps:
    - name: initialize token fetcher service
      service: ssc-sdk-shared-token-fetcher
      command: true
    - name: create a tenant for CI
      service: ssc-sdk-shared-tenant-creation
      command: python /opt/splunk/ssc-sdk-shared/tenant-creation/tenant_creation.py
    - type: parallel
      name: integration tests
      steps:
        - name: integration tests - not gated
          service: ssc-client-go-against-playground
          exclude: ^(master|develop)$
          command: bash -c "allow_failures=1 ./ci/integration/runtests.sh"
        - name: integration tests - gated
          service: ssc-client-go-against-playground
          tag: ^(master|develop)$
          command: bash -c "allow_failures=0 ./ci/integration/runtests.sh"
    - name: delete tenant that was created
      service: ssc-sdk-shared-tenant-creation
      command: python /opt/splunk/ssc-sdk-shared/tenant-creation/tenant_deletion.py
